import numpy as np
from dtw import dtw
import matplotlib
matplotlib.use("TKAgg")
from matplotlib import pyplot as plt
from scipy.misc import electrocardiogram
from scipy.signal import find_peaks
from numpy import convolve

triceps = [-0.1101888,  -0.1110026,  -0.1023763,  -0.05094401, -0.00634766,  0.08870443,
            0.15348308,  0.21826172,  0.1953125,   0.11458334, -0.00227865, -0.11946614,
           -0.16894531, -0.19091797, -0.21435547]

circles = [-1.616862,   -1.67122398, -1.57600913, -1.35579429, -1.0847982,  -0.83723958,
           -0.59488932, -0.34554036, -0.0843099,   0.10335286,  0.24088541,  0.28841145,
            0.21988932, -0.03955079, -0.35139974, -0.72460938, -1.08626302, -1.41520184,
           -1.5559896,  -1.460612  ]

arm = [0.26079102, 0.26000977, 0.26850586, 0.27875976, 0.28647461, 0.30717773,
       0.32788086, 0.34326172, 0.36303711, 0.3725586,  0.38115235, 0.38999024,
       0.40356445, 0.40883789, 0.41069336, 0.41108399, 0.40732422, 0.4128418,
       0.41269531, 0.40620117, 0.39067383, 0.37714844, 0.35708008, 0.33666992,
       0.32148438, 0.30473633, 0.29775391, 0.30043945]

tricepsA = [-0.1611328125, -0.1728515625, -0.05078125, -0.0751953125, -0.041015625, 0.2705078125, 0.4560546875, 0.4580078125, 0.1708984375, 0.283203125, 0.2890625, 0.2763671875, 0.255859375, 0.01953125, -0.19921875, -0.822265625, -0.5439453125, -0.5244140625, -0.33203125, 0.1005859375, 1.02734375, 0.6591796875, 0.3427734375, 0.51171875, 0.4111328125, 0.265625, 0.1005859375, 0.046875, -0.24609375, -0.1904296875, -0.5166015625, -0.4785156548023224, -0.40625, -0.1533203125, 0.09765625, -0.014648436568677425, 0.6865234375, 0.4755859673023224, 0.623046875, 0.654296875, 0.2177734375, 0.2382812649011612, 0.1298828125, -0.2138672024011612, -0.525390625, -0.455078125, -0.45703125, -0.333984375, 0.146484375, 0.3720703125, 0.533203125, 0.8134765625, 1.037109375, 1.060546875, 1.0615234375, 0.7275390625, 0.404296875, 0.0517578125, -0.296875, -0.435546875, -0.630859375, -0.5439453125, -0.2216796875, -0.013671875, 0.6162109375, 0.787109375, 1.017578125, 1.017578125, 1.015625, 1.0859375, 0.9365233778953552, 0.302734375, 0.1054687425494194, -0.2382812649011612, -0.306640625, -0.6728515625, -0.498046875, -0.095703125, 0.014648436568677425, 0.46484375, 0.75, 0.7294921875, 0.5966796875, 0.4345703423023224, 0.3193359375, 0.1787109375, 0.1552734375, -0.0556640625, -0.1220703125, -0.0859375, -0.4238280951976776, -0.4316406548023224, -0.103515625, 0.24609375, 0.3876953125, 0.8203125, 1.1162109375, 1.3427734375, 1.048828125, 0.5712890625, 0.4208984076976776, 0.126953125, -0.0166015625, -0.2099609225988388, -0.318359375, -0.49609375, -0.4990234375, -0.193359375, 0.1650390625, 0.8115234375, 0.7724609375, 0.822265625, 0.9169921875, 0.8017578125, 0.4560546875, 0.3046875, -0.0771484375, -0.2197265625, -0.248046875, -0.60546875, -0.4316406548023224, -0.177734375, 0.1318359375, 0.39453125, 0.5908203125, 0.599609375, 0.607421875, 0.5341796875, 0.6376953125, 0.2646484375, 0.1357421875, 0.0546875, -0.017578125, -0.189453125, -0.6328125, -0.572265625, -0.26171875, 0.06640625, 0.54296875, 0.36328125, 0.4248046576976776, 0.4199218451976776, 0.19921875, 0.2158203274011612, 0.0634765625, -0.1689453125, -0.08984375, -0.0546875, 0.0224609375, 0, 0.1191406324505806, 0.16015625, 0.08203125, 0.0634765625, 0.1650390625, -0.014648436568677425, 0.021484375, -0.0185546875, 0.0029296875, 0.0771484375, 0.0029296875, -0.015625, 0, -0.014648436568677425, 0.001953125, -0.0009765625, -0.0224609375, 0, 0.0400390625, -0.158203125, -0.0576171875, -0.0908203125, -0.2197265625, -0.2587890625, -0.259765625, -0.294921875]
tricepsB = [-0.650390625, -0.4716796576976776, -0.1240234375, -0.103515625, 0.166015625, 0.33984375, 0.412109375, 0.8056640625, 0.6552734375, 0.6162109375, 0.134765625, -0.1220703125, -0.4218749701976776, -0.9326171278953552, -0.5322265625, -0.1611328125, 0.404296875, 0.4375, 0.162109375, 0.404296875, 0.19921875, 0.2373046725988388, 0.2001953125, -0.0244140625, -0.16796875, -0.322265625, -0.4033203125, -0.509765625, -0.4248046576976776, -0.4140625, -0.4277344048023224, -0.353515625, -0.2412109524011612, -0.2958984375, -0.0869140625, -0.0859375, -0.0107421875, 0, 0.2568359375, 0.1357421875, 0.2402343899011612, 0.115234375, -0.0576171875, 0, -0.1279296875, -0.197265625, -0.2314453125, -0.140625, -0.2255859375, -0.330078125, -0.345703125, -0.3251953125, -0.34765625, -0.328125, -0.30078125, -0.337890625, -0.1357421875, -0.232421875, 0.0478515625, 0.05078125, 0.1513671875, 0.3349609375, 0.3828125, 0.3310546875, 0.244140625, 0.1376953125, 0.0380859375, -0.0537109412252903, -0.2607421875, -0.2734375, -0.302734375, -0.2578125, -0.232421875, -0.365234375, -0.34375, -0.3369140625, -0.326171875, -0.1279296875, 0.0576171875, 0.0244140625, 0.1787109375, 0.2373046725988388, 0.2626953125, 0.361328125, 0.169921875, 0.126953125, 0.0400390625, -0.0859375, -0.1728515625, -0.1796875, -0.181640625, -0.2148437649011612, -0.2646484375, -0.3720703125, -0.3837890625, -0.2548828125, -0.126953125, 0.014648436568677425, -0.072265625, 0.0078125, 0.193359375, 0.3544921875, 0.2255859375, 0.3681640625, 0.1923828125, 0.16015625, 0.08203125, -0.048828125, -0.1650390625, -0.1884765625, -0.193359375, -0.3046875, -0.361328125, -0.345703125, -0.4052734375, -0.2744140625, -0.078125, 0.162109375, 0.03125, 0.064453125, 0.3525390625, 0.4111328125, 0.4199218451976776, 0.3447265625, 0.1484375, -0.0478515625, -0.1083984449505806, -0.087890625, -0.1533203125, -0.162109375, -0.04296875, -0.26171875, -0.3017578125, -0.2841796875, -0.2431640625, -0.1728515625, -0.203125, -0.005859375, 0.025390625, 0.099609375, 0.2392578274011612, 0.330078125, 0.36328125, 0.400390625, 0.341796875, 0.169921875, 0.017578125, -0.009765625, -0.15234375, -0.1455078125, -0.2275390625, -0.23046875, -0.1611328125, -0.298828125, -0.31640625, -0.22265625, -0.1572265625, -0.150390625, 0.02636718563735485, 0.03515625, 0.1513671875, 0.2763671875, 0.224609375, 0.228515625, 0.2607421875, 0.1572265625, 0.111328125, 0.0419921875, -0.0654296875, -0.205078125, -0.26171875, -0.2197265625, -0.2109374850988388, -0.1484375, -0.15625, -0.0673828125, -0.083984375, -0.1953125, -0.30859375, -0.2939453125, -0.21875, 0.025390625, 0.076171875, 0.189453125, 0.2626953125, 0.3974609375, 0.2236328125, 0.1708984375, -0.0419921875, -0.1025390625, -0.169921875, -0.228515625, -0.162109375, -0.169921875, -0.076171875, -0.1572265625, -0.2841796875, -0.271484375, -0.3115234375, -0.2666015625, -0.138671875, -0.0576171875, 0.1630859375, -0.041015625, 0.3076171875, 0.15625, 0.3271484375, 0.1943359375, 0.1845703125, 0.0283203125, 0.0693359375, 0.0009765625, -0.2167968899011612, -0.2080077975988388, -0.1513671875, -0.1923828125, -0.173828125, -0.103515625, -0.197265625, -0.2451171875, -0.267578125, -0.279296875, -0.2685546875, -0.001953125, -0.0751953125, 0.140625, 0.2138672024011612, 0.376953125, 0.337890625, 0.15625, -0.0009765625, -0.02636718563735485, -0.09765625, -0.126953125, -0.0830078125, 0.02636718563735485, 0.0634765625, -0.1865234375, -0.2382812649011612, -0.1669921875, -0.2265625, -0.2783203125, -0.2089843600988388, 0.001953125, -0.046875, 0.1474609375, 0.3056640625, 0.2451171875, 0.2138672024011612, 0.1162109375, 0.1611328125, 0.044921875, -0.015625, -0.1416015625, -0.1669921875, -0.103515625, -0.0654296875, -0.1376953125, -0.1796875, -0.1826171875, -0.2275390625, -0.359375, 0.0205078125, 0.1953125, 0.28125, 0.291015625, 0.275390625, 0.25390625, 0.33203125, 0.1416015625, 0.2343749850988388, 0.1220703125, -0.048828125, -0.162109375, -0.1142578125, -0.1054687425494194, -0.0625, 0.0390625, -0.1572265625, -0.125, -0.1796875, -0.103515625, -0.1962890625, -0.0009765625, 0.248046875, 0.3330078125, 0.298828125, -0.1376953125, -0.111328125, -0.2705078125, -0.08984375, -0.181640625, -0.2900390625, -0.2734375, -0.2431640625, -0.2568359375, -0.3466796875]
tricepsC = [0.138671875, 0.0908203125, 0.146484375, 0.087890625, 0.130859375, 0.166015625, 0.2109374850988388, 0.2412109524011612, 0.205078125, 0.22265625, 0.248046875, 0.30859375, -0.07421875, 0.138671875, 0.0712890625, 0.0673828125, 0, 0.685546875, 0.1875, 0.615234375, 1.1318359375, 0.5361328125, 0.3173828125, 0.2041015625, 0.0556640625, -0.2128906399011612, -0.314453125, -0.24609375, -0.24609375, -0.2363281100988388, -0.2451171875, -0.2451171875, -0.2421875149011612, -0.2744140625, -0.2119140475988388, -0.251953125, -0.28125, -0.2802734375, -0.3037109375, -0.2646484375, -0.2822265625, -0.2255859375, -0.134765625, -0.130859375, -0.1318359375, -0.140625, -0.16796875, -0.158203125, -0.1748046875, -0.177734375, -0.171875, -0.1845703125, -0.169921875, -0.126953125, -0.099609375, -0.09765625, -0.0908203125, -0.041015625, -0.0517578125, -0.0556640625, -0.0537109412252903, -0.0615234375, -0.0517578125, -0.048828125, -0.076171875, -0.076171875, -0.08203125, -0.0810546875, -0.0927734375, -0.0986328125, -0.1005859375, -0.1103515625, -0.1318359375, -0.150390625, -0.1669921875, -0.1689453125, -0.2490234375, -0.267578125, -0.3466796875, -0.4453125, -0.4794922173023224, -0.486328125, -0.447265625, -0.5068359375, -0.4677734076976776, -0.4560546875, -0.453125, -0.4453125, -0.302734375, -0.1552734375, -0.3505859375, -0.4218749701976776, -0.51953125, -0.326171875, -0.541015625, -0.4667968451976776]
tricepsD = [-0.32421875, -0.21875, -0.1025390625, -0.048828125, -0.009765625, 0.04296875, 0.232421875, 0.1884765625, 0.1201171949505806, 0.048828125, 0.0869140625, 0.03027343936264515, -0.041015625, 0.072265625, -0.044921875, 0.1943359375, 0.279296875, 0.298828125, 0.8828125, 0.0869140625, 0.03027343936264515, -0.14453125, -0.189453125, -0.4921875, -0.41015625, -0.4931640625, -0.392578125, -0.2158203274011612, -0.1298828125, 0.1552734375, 0.193359375, 0.0751953125, 0.1318359375, 0.396484375, 0.1943359375, 0.2265625, 0.2998046875, 0.2490234375, 0.0498046875, -0.123046875, -0.1279296875, -0.1884765625, -0.1650390625, -0.0615234375, -0.1064453199505806, -0.2119140475988388, -0.2900390625, -0.2216796875, -0.025390625, -0.0654296875, -0.01171875, 0.1884765625, 0.048828125, 0.265625, 0.455078125, 0.3359375, 0.3046875, 0.388671875, 0.197265625, 0.2158203274011612, 0.0615234375, -0.056640625, -0.1748046875, 0.0595703162252903, 0.1015625, 0.0537109412252903, -0.16015625, -0.1748046875, -0.041015625, -0.1201171949505806, 0.126953125, 0.302734375, 0.2392578274011612, 0.533203125, 0.6005859375, 0.6171875, 0.53515625, 0.5556640625, 0.3251953125, 0.2001953125, 0.0576171875, -0.1552734375, -0.1953125, -0.3984375, -0.2763671875, -0.3505859375, -0.45703125, -0.3017578125, -0.2763671875, -0.2578125, -0.23046875, -0.0068359375, 0.3291015625, 0.3193359375, 0.376953125, 0.494140625, 0.6171875, 0.6455078125, 0.5078125, 0.3388671875, 0.2822265625, 0.17578125, -0.025390625, -0.1396484375, -0.0986328125, -0.1376953125, -0.15625, -0.2890625, -0.283203125, -0.1708984375, -0.2734375, -0.1015625, -0.19140625, -0.189453125, -0.140625, 0.041015625, 0.25, 0.3203125, 0.2490234375, 0.3046875, 0.1191406324505806, 0.29296875, 0.1484375, 0.1474609375, 0.0029296875, -0.00390625, -0.1201171949505806, -0.4169921576976776, -0.37890625, -0.4365234375, -0.4326172173023224, -0.2255859375, 0.1376953125, 0.009765625, 0.142578125, 0.251953125, 0.1337890625, -0.03125, -0.2099609225988388, -0.087890625, 0.0673828125, 0.0556640625, -0.014648436568677425, -0.0439453125, -0.0068359375, -0.08984375, 0.109375, 0.1044921800494194, 0.126953125, 0.0810546875, 0.091796875, 0.109375, 0.076171875]

def draw_peaks(x):
	x = np.array(x)
	peaks, _ = find_peaks(x, height=-2)
	plt.plot(x)
	plt.plot(peaks, x[peaks], "x")
	plt.plot(np.zeros_like(x), "--", color="gray")
	plt.show()	

def calculate_dtw(x, y):
	x = np.array(x)
	y = np.array(y)
	euclidean_norm = lambda x, y: np.abs(x - y)
	d, cost_matrix, acc_cost_matrix, path = dtw(x, y, dist=euclidean_norm)
	print(d)

def movingaverage (values, window):
    weights = np.repeat(1.0, window)/window
    sma = np.convolve(values, weights, 'valid')
    return sma

def normalize_and_draw(x):
	if(len(x)):
	    yMA = movingaverage(x, 6)
	    draw_peaks(yMA)

draw_peaks(arm)
yMA = movingaverage(arm, 20)
cut = yMA[58:86]
print(cut)

# yMA_exercise = movingaverage(circles, 6)

plt.plot(yMA)
plt.show()
draw_peaks(yMA)

# draw_peaks(cut)
# calculate_dtw(yMA, yMA_exercise)


