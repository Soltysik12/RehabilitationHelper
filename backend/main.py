import numpy as np
from dtw import dtw
import matplotlib
matplotlib.use("TKAgg")
from matplotlib import pyplot as plt
from scipy.misc import electrocardiogram
from scipy.signal import find_peaks
from numpy import convolve

# triceps_template = [-0.1101888,  -0.1110026,  -0.1023763,  -0.05094401, -0.00634766,  0.08870443,
#			0.15348308,  0.21826172,  0.1953125,   0.11458334, -0.00227865, -0.11946614,
#		   -0.16894531, -0.19091797, -0.21435547]

# circles_template = [-1.616862,   -1.67122398, -1.57600913, -1.35579429, -1.0847982,  -0.83723958,
#		   -0.59488932, -0.34554036, -0.0843099,   0.10335286,  0.24088541,  0.28841145,
#			0.21988932, -0.03955079, -0.35139974, -0.72460938, -1.08626302, -1.41520184,
#		   -1.5559896,  -1.460612  ]

# arm_template = [0.26079102, 0.26000977, 0.26850586, 0.27875976, 0.28647461, 0.30717773,
#	   0.32788086, 0.34326172, 0.36303711, 0.3725586,  0.38115235, 0.38999024,
#	   0.40356445, 0.40883789, 0.41069336, 0.41108399, 0.40732422, 0.4128418,
#	   0.41269531, 0.40620117, 0.39067383, 0.37714844, 0.35708008, 0.33666992,
#	   0.32148438, 0.30473633, 0.29775391, 0.30043945]

arm_template = [0.3125, 0.4287109673023224, 0.2177734375, 0.4296875298023224, 0.4853515625, 0.5869140625, 0.318359375, 0.5126953125, 0.3349609375, 0.4443359375, 0.390625, 0.4160155951976776, 0.4453125, 0.4638671875, 0.453125, 0.4794922173023224, 0.5703125, 0.5439453125, 0.640625, 0.6552734375, 0.740234375, 0.814453125, 0.7177734375, 0.755859375, 0.6650390625, 0.8740234375, 0.8515625596046448, 0.802734375, 0.8701171875, 1.076171875, 0.9873046875, 0.8603516221046448, 0.7578125, 0.8095703125, 0.75390625, 0.7490234375, 0.642578125, 0.671875, 0.658203125, 0.62890625, 0.619140625, 0.6533203125, 0.689453125, 0.6484375, 0.58203125, 0.58984375, 0.619140625, 0.5439453125, 0.5205078125, 0.46484375, 0.4873046875, 0.5419921875, 0.5107421875, 0.560546875, 0.5576171875, 0.587890625, 0.546875, 0.5283203125, 0.6123046875, 0.5458984375, 0.4824219048023224, 0.4775390923023224, 0.505859375, 0.55078125, 0.6103515625, 0.5966796875, 0.5595703125, 0.5078125, 0.599609375, 0.5791015625, 0.5888671875, 0.5986328125, 0.6435546875, 0.60546875, 0.6591796875, 0.6884765625, 0.685546875, 0.755859375, 0.728515625, 0.7939453125, 0.7578125, 0.7177734375, 0.7568359375, 0.8330077528953552, 0.8496093153953552, 0.8662109971046448, 1.1484375, 0.9140625, 0.98046875, 1.0263671875, 0.92578125, 0.876953125, 0.8486327528953552, 0.8515625596046448, 0.787109375, 0.7978515625, 0.794921875, 0.689453125, 0.7470703125, 0.61328125, 0.662109375, 0.625, 0.662109375, 0.6171875, 0.6513671875, 0.513671875, 0.638671875, 0.634765625, 0.62890625, 0.50390625, 0.5078125, 0.451171875, 0.3974609375, 0.4248046576976776, 0.400390625, 0.4560546875, 0.517578125, 0.541015625, 0.4853515625, 0.5166015625, 0.623046875, 0.5693359375, 0.6103515625, 0.69921875, 0.69140625, 0.6552734375, 0.626953125, 0.685546875, 0.7861328125, 0.7255859375, 0.79296875, 0.791015625, 0.8447265028953552, 0.8134765625, 0.892578125, 0.8369140028953552, 0.9052734375, 1.0693359375, 1.072265625, 0.900390625, 0.7578125, 0.7958984375, 0.8125, 0.7666015625, 0.755859375, 0.6826171875, 0.6787109375, 0.6416015625, 0.662109375, 0.6064453125, 0.6416015625, 0.6513671875, 0.712890625, 0.5908203125, 0.5869140625, 0.6728515625, 0.6455078125, 0.5810546875, 0.576171875, 0.5078125, 0.3388671875, 0.521484375, 0.560546875, 0.591796875, 0.6083984375, 0.62109375, 0.591796875, 0.6337890625, 0.4755859673023224, 0.6923828125, 0.701171875, 0.765625, 0.763671875, 0.826171875, 0.7548828125, 0.712890625, 0.6494140625, 0.783203125, 0.78125, 0.80078125, 0.8613281846046448, 1.1650390625, 1.1220703125, 0.923828125, 0.8896484375, 0.798828125, 0.8193359375, 0.7548828125, 0.7392578125, 0.6884765625, 0.80078125, 0.8056640625, 0.7744140625, 0.6171875, 0.66796875, 0.634765625, 0.568359375, 0.5390625, 0.5126953125, 0.490234375, 0.4345703423023224, 0.5087890625, 0.4824219048023224, 0.44921875, 0.48828125, 0.4736327826976776, 0.46484375, 0.4794922173023224, 0.4726562201976776, 0.4707030951976776, 0.4824219048023224, 0.4707030951976776, 0.4638671875, 0.498046875, 0.4765625298023224, 0.4667968451976776, 0.4707030951976776]


triceps_template = [-0.01171875, -0.0693359375, -0.03027343936264515, -0.0791015625, -0.2236328125, -0.056640625, 0.0205078125, 0.1552734375, 0.3046875, 0.5478515625, 0.1611328125, 0.1240234375, 0.0390625, -0.0947265625, -0.02734375, 0.1591796875, -0.12890625, -0.0478515625, 0.0712890625, 0.056640625, 0.0966796875, 0.4257812798023224, 0.1328125, -0.0830078125, 0.1962890625, -0.263671875, -0.02734375, -0.1494140625, 0.0029296875, -0.076171875, -0.1474609375, -0.2685546875, 0.0244140625, 0.1591796875, 0.2705078125, 0.494140625, 0.2412109524011612, 0.1201171949505806, -0.11328125, -0.3251953125, -0.4306640923023224, -0.2089843600988388, -0.0556640625, -0.01171875, -0.25390625, -0.193359375, -0.1054687425494194, 0.0087890625, 0.28125, 0.9453124403953552, 0.2412109524011612, -0.014648436568677425, -0.001953125, 0.0595703162252903, -0.0546875, -0.0546875, -0.1552734375, -0.103515625, -0.154296875, -0.1708984375, -0.0527343712747097, -0.181640625, -0.1064453199505806]
# circles_template = [-0.0673828125, -0.2294921875, -0.4189452826976776, -0.39453125, -0.298828125, 0.0419921875, 0.263671875, 0.37109375, 0.2343749850988388, -0.02929687313735485, -0.685546875, -1.21875, -1.271484375, -1.6669920682907104, -1.7568359375, -1.8076171875, -1.625, -1.2548828125, -0.9287109375, -0.806640625, -0.6474609375, -0.36328125, -0.138671875, 0.296875, 0.4296875298023224, 0.0585937462747097, -0.38671875, -0.990234375, -1.287109375, -1.7578125, -2.1533203125, -2.0556640625, -1.5751953125, -1.232421875, -0.978515625, -0.8154296875, -0.74609375, -0.3193359375, -0.4912109375, -0.0830078125, 0.359375, 0.0703125, -0.287109375, -0.5546875, -1.048828125, -1.4111328125, -1.4208984375, -1.6337890625, -2.03125, -1.6660155057907104, -1.2880859375, -0.9921875, -0.9589844346046448, -0.8593750596046448, -0.4296875298023224, -0.0341796875, 0.2568359375, 0.4765625298023224, 0.1943359375, -0.3291015625, -0.89453125, -1.4931640625, -1.9765625, -2.1416015625, -1.7158204317092896, -1.4794921875, -1.220703125, -0.921875, -0.6552734375, -0.515625, -0.23046875, -0.025390625, 0.275390625, 0.6455078125, 0.4707030951976776, 0.3095703125, 0.0546875, -0.4365234375, -1.28125, -1.2255859375, -1.7685546875, -1.8603515625, -1.9189454317092896, -1.28125, -0.708984375, -0.2685546875, -0.021484375, 0.1435546875, 0.26171875, 0.25, 0.232421875, 0.26171875, 0.375, 0.2431640625, 0.24609375, 0.279296875, 0.2763671875, 0.2978515625, 0.28125, 0.255859375, 0.26953125, 0.228515625, 0.25, 0.275390625, 0.3056640625, 0.3271484375, 0.3525390625]
circles_template = [-0.0361328125, 0.041015625, -0.0888671875, 0.0527343712747097, -0.0673828125, 0.09765625, 0.0888671875, 0.09765625, 0.2314453125, 0.25390625, 0.4169921576976776, 0.529296875, 0.68359375, 0.818359375, 0.8154296875, 0.8134765625, 0.99609375, 0.9374999403953552, 1.0029296875, 1.0107421875, 0.9384765028953552, 0.7919921875, 0.8984375, 0.8652344346046448, 0.8652344346046448, 0.7705078125, 0.75390625, 0.673828125, 0.74609375, 0.6474609375, 0.71484375, 0.740234375, 0.794921875, 0.8378905653953552, 0.8583984971046448, 0.9013671875, 0.9326171278953552, 0.7314453125, 0.7900390625, 0.748046875, 0.6337890625, 0.6337890625, 0.4404296875, 0.357421875, 0.26953125, 0.1796875, 0.1396484375, 0.08203125, -0.0439453125, -0.0986328125, -0.1474609375, -0.1953125, -0.2294921875, -0.177734375, -0.1708984375, -0.1103515625, -0.05078125, 0.01171875, 0.091796875, 0.041015625, 0.263671875, 0.26953125, 0.3515625, 0.4150390625, 0.4765625298023224, 0.587890625, 0.626953125, 0.5888671875, 0.7333984375, 0.8095703125, 0.8125, 0.8876953125, 1.0546875, 0.9433593153953552, 0.9052734375, 0.9394530653953552, 1.0224609375, 0.9755859375, 0.921875, 1.037109375, 0.9492186903953552, 0.880859375, 0.7919921875, 0.7314453125, 0.6806640625, 0.7060546875, 0.693359375, 0.6796875, 0.7001953125, 0.66015625, 0.759765625, 0.818359375, 1.0048828125, 1.0419921875, 0.904296875, 0.9443358778953552, 0.8681641221046448, 0.8212890625, 0.8457030653953552, 0.7392578125, 0.615234375, 0.560546875, 0.4501953125, 0.3935546875, 0.2890625, 0.1953125, 0.02929687313735485, 0.013671875, 0.00390625, -0.0625, -0.0537109412252903, -0.1044921800494194, -0.05078125, -0.056640625, -0.0634765625, 0.0400390625, 0.015625, 0.03027343936264515, 0.1162109375, 0.2646484375, 0.4375, 0.498046875, 0.7060546875, 0.775390625, 0.90625, 0.8427733778953552, 1, 1.046875, 0.9306640028953552, 0.9619141221046448, 1.1826171875, 1.119140625, 1.083984375, 1.06640625, 0.9931640625, 0.8388671278953552, 0.7470703125, 0.7255859375, 0.7705078125, 0.765625, 0.8193359375, 0.818359375, 0.8935546875, 0.9873046875, 1.0234375, 1.0546875, 1.087890625, 1.1533203125, 1.068359375, 0.9492186903953552, 0.7880859375, 0.740234375, 0.7587890625, 0.5546875, 0.55859375, 0.396484375, 0.279296875, 0.1767578125, 0.1162109375, 0.1025390625, 0.03125, -0.0048828125, -0.068359375, -0.021484375, 0.0751953125, 0.0810546875, 0.138671875, 0.12890625, 0.2705078125, 0.296875, 0.3994140625, 0.4423828125, 0.6474609375, 0.875, 0.8701171875, 1.1142578125, 1.1728515625, 1.072265625, 1.0126953125, 1.04296875, 1.064453125, 1.0009765625, 1.00390625, 0.8457030653953552, 0.77734375, 0.7724609375, 0.80859375, 0.7509765625, 0.8173828125, 0.919921875, 0.90625, 0.9531250596046448, 1.111328125, 1.228515625, 1.1103515625, 0.9560547471046448, 0.91015625, 0.7919921875, 0.6572265625, 0.5390625, 0.40234375, 0.205078125, 0.0751953125, 0.134765625, 0.0732421875, 0.2167968899011612, 0.1455078125, 0.0849609375, 0.2148437649011612, 0.09765625, 0.0078125, 0.1875, 0.05078125, 0.01953125, 0.0361328125, 0.0527343712747097, 0.0478515625, 0.09765625, 0.0595703162252903, 0.1376953125]

tricepsA = [-0.1611328125, -0.1728515625, -0.05078125, -0.0751953125, -0.041015625, 0.2705078125, 0.4560546875, 0.4580078125, 0.1708984375, 0.283203125, 0.2890625, 0.2763671875, 0.255859375, 0.01953125, -0.19921875, -0.822265625, -0.5439453125, -0.5244140625, -0.33203125, 0.1005859375, 1.02734375, 0.6591796875, 0.3427734375, 0.51171875, 0.4111328125, 0.265625, 0.1005859375, 0.046875, -0.24609375, -0.1904296875, -0.5166015625, -0.4785156548023224, -0.40625, -0.1533203125, 0.09765625, -0.014648436568677425, 0.6865234375, 0.4755859673023224, 0.623046875, 0.654296875, 0.2177734375, 0.2382812649011612, 0.1298828125, -0.2138672024011612, -0.525390625, -0.455078125, -0.45703125, -0.333984375, 0.146484375, 0.3720703125, 0.533203125, 0.8134765625, 1.037109375, 1.060546875, 1.0615234375, 0.7275390625, 0.404296875, 0.0517578125, -0.296875, -0.435546875, -0.630859375, -0.5439453125, -0.2216796875, -0.013671875, 0.6162109375, 0.787109375, 1.017578125, 1.017578125, 1.015625, 1.0859375, 0.9365233778953552, 0.302734375, 0.1054687425494194, -0.2382812649011612, -0.306640625, -0.6728515625, -0.498046875, -0.095703125, 0.014648436568677425, 0.46484375, 0.75, 0.7294921875, 0.5966796875, 0.4345703423023224, 0.3193359375, 0.1787109375, 0.1552734375, -0.0556640625, -0.1220703125, -0.0859375, -0.4238280951976776, -0.4316406548023224, -0.103515625, 0.24609375, 0.3876953125, 0.8203125, 1.1162109375, 1.3427734375, 1.048828125, 0.5712890625, 0.4208984076976776, 0.126953125, -0.0166015625, -0.2099609225988388, -0.318359375, -0.49609375, -0.4990234375, -0.193359375, 0.1650390625, 0.8115234375, 0.7724609375, 0.822265625, 0.9169921875, 0.8017578125, 0.4560546875, 0.3046875, -0.0771484375, -0.2197265625, -0.248046875, -0.60546875, -0.4316406548023224, -0.177734375, 0.1318359375, 0.39453125, 0.5908203125, 0.599609375, 0.607421875, 0.5341796875, 0.6376953125, 0.2646484375, 0.1357421875, 0.0546875, -0.017578125, -0.189453125, -0.6328125, -0.572265625, -0.26171875, 0.06640625, 0.54296875, 0.36328125, 0.4248046576976776, 0.4199218451976776, 0.19921875, 0.2158203274011612, 0.0634765625, -0.1689453125, -0.08984375, -0.0546875, 0.0224609375, 0, 0.1191406324505806, 0.16015625, 0.08203125, 0.0634765625, 0.1650390625, -0.014648436568677425, 0.021484375, -0.0185546875, 0.0029296875, 0.0771484375, 0.0029296875, -0.015625, 0, -0.014648436568677425, 0.001953125, -0.0009765625, -0.0224609375, 0, 0.0400390625, -0.158203125, -0.0576171875, -0.0908203125, -0.2197265625, -0.2587890625, -0.259765625, -0.294921875]
tricepsB = [-0.650390625, -0.4716796576976776, -0.1240234375, -0.103515625, 0.166015625, 0.33984375, 0.412109375, 0.8056640625, 0.6552734375, 0.6162109375, 0.134765625, -0.1220703125, -0.4218749701976776, -0.9326171278953552, -0.5322265625, -0.1611328125, 0.404296875, 0.4375, 0.162109375, 0.404296875, 0.19921875, 0.2373046725988388, 0.2001953125, -0.0244140625, -0.16796875, -0.322265625, -0.4033203125, -0.509765625, -0.4248046576976776, -0.4140625, -0.4277344048023224, -0.353515625, -0.2412109524011612, -0.2958984375, -0.0869140625, -0.0859375, -0.0107421875, 0, 0.2568359375, 0.1357421875, 0.2402343899011612, 0.115234375, -0.0576171875, 0, -0.1279296875, -0.197265625, -0.2314453125, -0.140625, -0.2255859375, -0.330078125, -0.345703125, -0.3251953125, -0.34765625, -0.328125, -0.30078125, -0.337890625, -0.1357421875, -0.232421875, 0.0478515625, 0.05078125, 0.1513671875, 0.3349609375, 0.3828125, 0.3310546875, 0.244140625, 0.1376953125, 0.0380859375, -0.0537109412252903, -0.2607421875, -0.2734375, -0.302734375, -0.2578125, -0.232421875, -0.365234375, -0.34375, -0.3369140625, -0.326171875, -0.1279296875, 0.0576171875, 0.0244140625, 0.1787109375, 0.2373046725988388, 0.2626953125, 0.361328125, 0.169921875, 0.126953125, 0.0400390625, -0.0859375, -0.1728515625, -0.1796875, -0.181640625, -0.2148437649011612, -0.2646484375, -0.3720703125, -0.3837890625, -0.2548828125, -0.126953125, 0.014648436568677425, -0.072265625, 0.0078125, 0.193359375, 0.3544921875, 0.2255859375, 0.3681640625, 0.1923828125, 0.16015625, 0.08203125, -0.048828125, -0.1650390625, -0.1884765625, -0.193359375, -0.3046875, -0.361328125, -0.345703125, -0.4052734375, -0.2744140625, -0.078125, 0.162109375, 0.03125, 0.064453125, 0.3525390625, 0.4111328125, 0.4199218451976776, 0.3447265625, 0.1484375, -0.0478515625, -0.1083984449505806, -0.087890625, -0.1533203125, -0.162109375, -0.04296875, -0.26171875, -0.3017578125, -0.2841796875, -0.2431640625, -0.1728515625, -0.203125, -0.005859375, 0.025390625, 0.099609375, 0.2392578274011612, 0.330078125, 0.36328125, 0.400390625, 0.341796875, 0.169921875, 0.017578125, -0.009765625, -0.15234375, -0.1455078125, -0.2275390625, -0.23046875, -0.1611328125, -0.298828125, -0.31640625, -0.22265625, -0.1572265625, -0.150390625, 0.02636718563735485, 0.03515625, 0.1513671875, 0.2763671875, 0.224609375, 0.228515625, 0.2607421875, 0.1572265625, 0.111328125, 0.0419921875, -0.0654296875, -0.205078125, -0.26171875, -0.2197265625, -0.2109374850988388, -0.1484375, -0.15625, -0.0673828125, -0.083984375, -0.1953125, -0.30859375, -0.2939453125, -0.21875, 0.025390625, 0.076171875, 0.189453125, 0.2626953125, 0.3974609375, 0.2236328125, 0.1708984375, -0.0419921875, -0.1025390625, -0.169921875, -0.228515625, -0.162109375, -0.169921875, -0.076171875, -0.1572265625, -0.2841796875, -0.271484375, -0.3115234375, -0.2666015625, -0.138671875, -0.0576171875, 0.1630859375, -0.041015625, 0.3076171875, 0.15625, 0.3271484375, 0.1943359375, 0.1845703125, 0.0283203125, 0.0693359375, 0.0009765625, -0.2167968899011612, -0.2080077975988388, -0.1513671875, -0.1923828125, -0.173828125, -0.103515625, -0.197265625, -0.2451171875, -0.267578125, -0.279296875, -0.2685546875, -0.001953125, -0.0751953125, 0.140625, 0.2138672024011612, 0.376953125, 0.337890625, 0.15625, -0.0009765625, -0.02636718563735485, -0.09765625, -0.126953125, -0.0830078125, 0.02636718563735485, 0.0634765625, -0.1865234375, -0.2382812649011612, -0.1669921875, -0.2265625, -0.2783203125, -0.2089843600988388, 0.001953125, -0.046875, 0.1474609375, 0.3056640625, 0.2451171875, 0.2138672024011612, 0.1162109375, 0.1611328125, 0.044921875, -0.015625, -0.1416015625, -0.1669921875, -0.103515625, -0.0654296875, -0.1376953125, -0.1796875, -0.1826171875, -0.2275390625, -0.359375, 0.0205078125, 0.1953125, 0.28125, 0.291015625, 0.275390625, 0.25390625, 0.33203125, 0.1416015625, 0.2343749850988388, 0.1220703125, -0.048828125, -0.162109375, -0.1142578125, -0.1054687425494194, -0.0625, 0.0390625, -0.1572265625, -0.125, -0.1796875, -0.103515625, -0.1962890625, -0.0009765625, 0.248046875, 0.3330078125, 0.298828125, -0.1376953125, -0.111328125, -0.2705078125, -0.08984375, -0.181640625, -0.2900390625, -0.2734375, -0.2431640625, -0.2568359375, -0.3466796875]
tricepsC = [0.138671875, 0.0908203125, 0.146484375, 0.087890625, 0.130859375, 0.166015625, 0.2109374850988388, 0.2412109524011612, 0.205078125, 0.22265625, 0.248046875, 0.30859375, -0.07421875, 0.138671875, 0.0712890625, 0.0673828125, 0, 0.685546875, 0.1875, 0.615234375, 1.1318359375, 0.5361328125, 0.3173828125, 0.2041015625, 0.0556640625, -0.2128906399011612, -0.314453125, -0.24609375, -0.24609375, -0.2363281100988388, -0.2451171875, -0.2451171875, -0.2421875149011612, -0.2744140625, -0.2119140475988388, -0.251953125, -0.28125, -0.2802734375, -0.3037109375, -0.2646484375, -0.2822265625, -0.2255859375, -0.134765625, -0.130859375, -0.1318359375, -0.140625, -0.16796875, -0.158203125, -0.1748046875, -0.177734375, -0.171875, -0.1845703125, -0.169921875, -0.126953125, -0.099609375, -0.09765625, -0.0908203125, -0.041015625, -0.0517578125, -0.0556640625, -0.0537109412252903, -0.0615234375, -0.0517578125, -0.048828125, -0.076171875, -0.076171875, -0.08203125, -0.0810546875, -0.0927734375, -0.0986328125, -0.1005859375, -0.1103515625, -0.1318359375, -0.150390625, -0.1669921875, -0.1689453125, -0.2490234375, -0.267578125, -0.3466796875, -0.4453125, -0.4794922173023224, -0.486328125, -0.447265625, -0.5068359375, -0.4677734076976776, -0.4560546875, -0.453125, -0.4453125, -0.302734375, -0.1552734375, -0.3505859375, -0.4218749701976776, -0.51953125, -0.326171875, -0.541015625, -0.4667968451976776]
tricepsD = [-0.32421875, -0.21875, -0.1025390625, -0.048828125, -0.009765625, 0.04296875, 0.232421875, 0.1884765625, 0.1201171949505806, 0.048828125, 0.0869140625, 0.03027343936264515, -0.041015625, 0.072265625, -0.044921875, 0.1943359375, 0.279296875, 0.298828125, 0.8828125, 0.0869140625, 0.03027343936264515, -0.14453125, -0.189453125, -0.4921875, -0.41015625, -0.4931640625, -0.392578125, -0.2158203274011612, -0.1298828125, 0.1552734375, 0.193359375, 0.0751953125, 0.1318359375, 0.396484375, 0.1943359375, 0.2265625, 0.2998046875, 0.2490234375, 0.0498046875, -0.123046875, -0.1279296875, -0.1884765625, -0.1650390625, -0.0615234375, -0.1064453199505806, -0.2119140475988388, -0.2900390625, -0.2216796875, -0.025390625, -0.0654296875, -0.01171875, 0.1884765625, 0.048828125, 0.265625, 0.455078125, 0.3359375, 0.3046875, 0.388671875, 0.197265625, 0.2158203274011612, 0.0615234375, -0.056640625, -0.1748046875, 0.0595703162252903, 0.1015625, 0.0537109412252903, -0.16015625, -0.1748046875, -0.041015625, -0.1201171949505806, 0.126953125, 0.302734375, 0.2392578274011612, 0.533203125, 0.6005859375, 0.6171875, 0.53515625, 0.5556640625, 0.3251953125, 0.2001953125, 0.0576171875, -0.1552734375, -0.1953125, -0.3984375, -0.2763671875, -0.3505859375, -0.45703125, -0.3017578125, -0.2763671875, -0.2578125, -0.23046875, -0.0068359375, 0.3291015625, 0.3193359375, 0.376953125, 0.494140625, 0.6171875, 0.6455078125, 0.5078125, 0.3388671875, 0.2822265625, 0.17578125, -0.025390625, -0.1396484375, -0.0986328125, -0.1376953125, -0.15625, -0.2890625, -0.283203125, -0.1708984375, -0.2734375, -0.1015625, -0.19140625, -0.189453125, -0.140625, 0.041015625, 0.25, 0.3203125, 0.2490234375, 0.3046875, 0.1191406324505806, 0.29296875, 0.1484375, 0.1474609375, 0.0029296875, -0.00390625, -0.1201171949505806, -0.4169921576976776, -0.37890625, -0.4365234375, -0.4326172173023224, -0.2255859375, 0.1376953125, 0.009765625, 0.142578125, 0.251953125, 0.1337890625, -0.03125, -0.2099609225988388, -0.087890625, 0.0673828125, 0.0556640625, -0.014648436568677425, -0.0439453125, -0.0068359375, -0.08984375, 0.109375, 0.1044921800494194, 0.126953125, 0.0810546875, 0.091796875, 0.109375, 0.076171875]

template_counts =	{
  "triceps": 1,
  "arm": 4,
  "circles": 2
}

def draw_peaks(x):
	x = np.array(x)
	peaks, _ = find_peaks(x, height=-2)
	plt.plot(x)
	plt.plot(peaks, x[peaks], "x")
	plt.plot(np.zeros_like(x), "--", color="gray")
	plt.show()	

def calculate_dtw(x, y):
	x = np.array(x)
	y = np.array(y)
	euclidean_norm = lambda x, y: np.abs(x - y)
	d, cost_matrix, acc_cost_matrix, path = dtw(x, y, dist=euclidean_norm)
	print(d)
	return d

def movingaverage (values, window):
	weights = np.repeat(1.0, window)/window
	sma = np.convolve(values, weights, 'valid')
	return sma

def find_exercise(x):
	# norm_triceps = movingaverage(triceps_template, 3)
	# norm_circles = movingaverage(circles_template, 3)
	# norm_arm = movingaverage(arm_template, 3)
	triceps_dtw = calculate_dtw(x, triceps_template)
	circles_dtw = calculate_dtw(x, circles_template)
	arm_dtw = calculate_dtw(x, arm_template)
	print("triceps", triceps_dtw)
	print("circles_dtw", circles_dtw)
	print("arm_dtw",arm_dtw)
	if(triceps_dtw<circles_dtw and triceps_dtw<arm_dtw):
		return "triceps"
	elif (circles_dtw<arm_dtw):
		return "circles"
	else:
		return "arm"

def count_repititions(x, template_counts):
	normed_template = movingaverage(x, 8)
	x = np.array(normed_template)
	peaks, _ = find_peaks(x, height=0.1)
	number_of_repetitions = len(peaks)/template_counts
	return number_of_repetitions


def find_repetitions_and_exercise(x):
	transformed_x = movingaverage(x, 6)
	exercise = find_exercise(transformed_x)
	# print(exercise)
	count = count_repititions(transformed_x, template_counts[exercise])
	# print(count)
	return {"exercise_name": exercise, "count": count}

# print(find_repetitions_and_exercise(triceps))
# draw_peaks(arm_template)
# cut = circles_template[25:80]
# yMA = movingaverage(arm_template, 3)
# cut = yMA[58:86]
# print(cut)

# yMA_exercise = movingaverage(circles, 6)

# plt.plot(yMA)
# plt.show()
# draw_peaks(yMA)



